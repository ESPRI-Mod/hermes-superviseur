#!/bin/ksh

#**************************************************************
# Author: Lola Falletti
# Contact: lola.falletti_at_idris.fr
# Date: {timestamp} $ Date of script generation
# IPSL ({year})
#  This software is governed by the CeCILL licence see libIGCM/libIGCM_CeCILL.LIC
#
#**************************************************************
#
# Format script for a late job
#
#**************************************************************


declare HPC_JOB_ID="{hpc_job_id}"
declare HPC_SUBMISSION_CMD="{hpc_submission_cmd}"
declare JOB_NAME="{job_name}"
declare RETRIEVE_JOB_STATUS=`{retrieve_job_status}`
declare SUBMISSION_PATH="{submission_path}"


function check_line_execution {
	if [ $? != 0 ]; then
		echo 'TODO'
	fi
}


if [ -z $RETRIEVE_JOB_STATUS ]; then 
	echo 'The job is not running so we continue the supervision'
	continue
elif [ $RETRIEVE_JOB_STATUS == "R" ]; then
	echo 'The job is still running, we cancel it and we continue the supervision.'
	llcancel $HPC_JOB_ID
	continue
elif [ $RETRIEVE_JOB_STATUS == "H" ]; then
	echo "The job has the status Hold, let the Computing Center do its work."
	echo "TODO: new table in the database with the job status?"
else
	echo $RETRIEVE_JOB_STATUS
	echo 'TODO: new table in the database with the job status?'
	return 1
fi
